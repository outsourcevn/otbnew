@model List<WebTMDT.Models.Product>
@using WebTMDT.Helpers;
<script>
    function showMenu(id) {
        //alert("ok");
        $("#menu_" + id).show();
    }
    function delpost(id,type){
        $("#product_" + id).html("Updating...");
        $.ajax({
            type: "POST",
            url: "/Product/delpost?id=" +id+"&type=" + type,
            cache: false
        }).done(function (html) {
            if (html == "1") {
                $("#product_" + id).hide();
            }else{
                $("#product_" + id).html("Lỗi!");
            }
        });
    }
</script>
<div class="row">
    <div class="col-md-12">
        @if (Model != null)
        {
            if (Model.Count > 0)
            {
                foreach (var item in Model)
                {
                    @*<div class="col-md-3 product-cat2" style="color: #333; margin-bottom: 15px;">
                        <a href="@string.Format("/{0}/{1}-{2}.html", Configs.unicodeToNoMark(@item.Category.F2), Configs.unicodeToNoMark(item.F2), item.F1)">
                            <img class="img-responsive" src="@if(item.F11 != null){@Html.Raw(item.F11)}" style="width: 100%; margin-bottom: 10px; height: 250px;" />
                            <p><b>@item.F2</b></p>
                            <p><b>Giá bán: </b> @String.Format(System.Globalization.CultureInfo.GetCultureInfo("vi-VN"), "{0:c}", @item.F3)</p>
                        </a>
                        <a href="@string.Format("/gianhang/{0}/{1}", @item.AspNetUser.UserName, Configs.unicodeToNoMark(@item.AspNetUser.UserName))">Người đăng: @item.AspNetUser.TenNguoiBan</a>
                        <a href="tel:@item.AspNetUser.PhoneNumber">Số điện thoại liên hệ: @item.AspNetUser.PhoneNumber</a>
                    </div>*@
                        <div class="row product" style="border:1px solid;" id="product_@item.F1">                            
                            <div class="col-xs-12 col-md-3">                                
                                <div class="thumbnail">
                                    <a href="@string.Format("/{0}/{1}-{2}.html", Configs.unicodeToNoMark(@item.Category.F2), Configs.unicodeToNoMark(item.F2), item.F1)"><img src="@item.F11" alt="@item.F2" class="img-responsive"></a>
                                    <p><b>@item.AspNetUser.TenNguoiBan</b></p>
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-9">
                                
                                    @*<i class="fa fa-angle-down"></i>*@

                                    @if (WebTMDT.Helpers.Configs.getCookie("user_type") == "3" || WebTMDT.Helpers.Configs.getCookie("user_type") == "2")
                                    {
                                        <div style="top:0px;right:0px;position:absolute;z-index:1002;" onclick="showMenu(@item.F1);">
                                            <a style="cursor:pointer;" onclick="showMenu(@item.F1);"><img src="~/Content/Images/down.png" style="width:16px;height:16px;" /></a>
                                            <div style="top:0px;right:0px;position:absolute;width:200px;display:none;background:#ff6a00;z-index:1001;" id="menu_@item.F1">
                                                <div style="width:100%;"><a onclick="delpost(@item.F1,1);" style="background:#ffd62c;color:#ffffff;width:100%;float: left;cursor:pointer;">Xóa bài</a></div>
                                                <div><a onclick="delpost(@item.F1,2);" style="background:#e76b33;color:#ffffff;width:100%;float: left;cursor:pointer;">Đánh dấu quan trọng</a></div>
                                                <div><a href="/product/edit/@item.F1" style="background:#ffcc33;color:#ffffff;width:100%;float: left;">Sửa bài</a></div>
                                            </div>
                                        </div>
                                    }
                               
                                <div class="row">
                                    <div class="col-sm-12">
                                        <a href="@string.Format("/{0}/{1}-{2}.html", Configs.unicodeToNoMark(@item.Category.F2), Configs.unicodeToNoMark(item.F2), item.F1)"><h3>@item.F2</h3></a>                                       
                                        <p><b>Ngày đăng: </b>@item.F10</p>
                                        <p><b>Điểm đi: </b> @item.F19</p>
                                        <p><b>Điểm đến: </b> @item.F20</p>
                                        <p class="giaban" style="top: 48%;">@String.Format("{0:n0}", @item.F3)</p>
                                        <p class="sodienthoai"><a href="tel:@item.AspNetUser.PhoneNumber">@item.AspNetUser.PhoneNumber</a></p>
                                        <p ><span style="background:#00ffff;">@Html.Raw(item.F12)</span></p>
                                    </div>                                    
                                </div>

                            </div>
                            @*<div class="col-xs-12 col-md-2">
                                @Html.ActionLink("Sửa", "Edit", "Product", new { id = @item.SanPhamId }, htmlAttributes: new { @class = "btn btn-primary btn-block" })
                                @Html.RouteLink("Sửa", "ProductEdit", new { id = @item.SanPhamId }, htmlAttributes: new { @class = "btn btn-primary btn-block" })
                            </div>*@
                        </div>
                        <div class="comments-container">
		                    <h1>Bình Luận</h1>
		                    <ul id="comments-list-@item.F1" class="comments-list">
			                    @*<li>
				                    <div class="comment-main-level">
					                    <!-- Avatar -->
					                    <div class="comment-avatar"><img src="http://i9.photobucket.com/albums/a88/creaticode/avatar_1_zps8e1c80cd.jpg" alt=""></div>
					                    <!-- Contenedor del Comentario -->
					                    <div class="comment-box">
						                    <div class="comment-head">
							                    <h6 class="comment-name by-author"><a href="http://creaticode.com/blog">Agustin Ortiz</a></h6>
							                    <span>hace 20 minutos</span>
							                    <i class="fa fa-reply"></i>
							                    <i class="fa fa-heart"></i>
						                    </div>
						                    <div class="comment-content">
							                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Velit omnis animi et iure laudantium vitae, praesentium optio, sapiente distinctio illo?
						                    </div>
					                    </div>
				                    </div>
			                    </li>
			                    <li>
				                    <div class="comment-main-level">
					                    <!-- Avatar -->
					                    <div class="comment-avatar"><img src="http://i9.photobucket.com/albums/a88/creaticode/avatar_2_zps7de12f8b.jpg" alt=""></div>
					                    <!-- Contenedor del Comentario -->
					                    <div class="comment-box">
						                    <div class="comment-head">
							                    <h6 class="comment-name"><a href="http://creaticode.com/blog">Lorena Rojero</a></h6>
							                    <span>hace 10 minutos</span>
							                    <i class="fa fa-reply"></i>
							                    <i class="fa fa-heart"></i>
						                    </div>
						                    <div class="comment-content">
							                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Velit omnis animi et iure laudantium vitae, praesentium optio, sapiente distinctio illo?
						                    </div>
					                    </div>
				                    </div>
			                    </li>*@
                                @{Html.RenderAction("listComment", new { product_id = item.F1 });}
                                <li>
                                    <div class="col-sm-12">
                                        <div class="comment_form" id="comment_dv_@item.F1">
                                            <textarea rows="10" id="comment_@item.F1" name="comment_@item.F1" placeholder="Bình luận" onkeypress="handle(event,@item.F1);"></textarea>
                                        </div>
                                    </div>
                                <li>
		                    </ul>
	                    </div>
                }
            }
            else
            {
                <span>Danh mục chưa có sản phẩm.</span>
            }
        }

    </div>
</div>
<script>
    function handle(e,id) {
        if (e.keyCode === 13) {
            //e.preventDefault(); // Ensure it is only this code that rusn
            //$("#comment_dv_" + id).html("Đang gửi...");
            //alert(document.getElementById('comment_'+id).value );
            var fdata = new FormData();
            fdata.append('full_content',document.getElementById('comment_'+id).value);
            fdata.append('id', id);
            //alert(document.getElementById('comment_'+id).value);
            $.ajax({                
                type: "POST",
                url: "/Product/comment",
                data:fdata,
                processData: false,
                contentType: false,
                cache: false
            }).done(function (html) {
                alert(html);
                if (html != "0") {
                    $("#comment_dv_" + id).html(document.getElementById('comment_'+id).value+"<br><span><a onclick='editpost("+html+",0);'>Sửa</a></span>-<span><a onclick='editpost("+html+",1);'>Xóa</a></span>");
                }else{
                    $("#comment_dv_" + id).html("Lỗi!");
                }
            });
        }
    }
</script>